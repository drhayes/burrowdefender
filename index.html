<!DOCTYPE HTML>
<html lang="en-US">
<head>
	<meta charset="UTF-8">
	<title>Minecraft Tower Defense 2d!</title>
	<script type="text/javascript" src="lib/jquery/jquery-1.4.2.min.js"></script>
	<script type="text/javascript" src="src/eventer.js"></script>
	<script type="text/javascript" src="src/utils.js"></script>
	<script type="text/javascript" src="src/tile.js"></script>
	<script type="text/javascript" src="src/tilemap.js"></script>
	<script type="text/javascript" src="src/mob.js"></script>
	<script type="text/javascript" src="src/spatialhash.js"></script>
	<script type="text/javascript" src="src/keyboardmanager.js"></script>
	<script type="text/javascript" src="src/updater.js"></script>
	<style type="text/css">
		#drawme {
			border: 1px solid #000;
		}
	</style>
</head>
<body>
	<button id="playerlog">Player log</button><br>
	<canvas id="drawme" width="600" height="500"></canvas>
	<script type="text/javascript">
		// grab the canvas and its context
		var canvas = $("#drawme")[0];
		var ctx = canvas.getContext("2d");
	
		// set up an initial, easy tilemap
		var tilemap = new TileMap();
		tilemap.set(0, 3, Tile.Dirt);
		tilemap.set(1, 3, Tile.Dirt);
		tilemap.set(2, 3, Tile.Dirt);
	
		// set up the spatial hash
		var spatialhash = new SpatialHash();
		var rect1 = TileMap.getrect(0, 3);
		var rect2 = TileMap.getrect(1, 3);
		var rect3 = TileMap.getrect(2, 3);
		spatialhash.set(rect1.x1, rect1.y1, rect1);
		spatialhash.set(rect2.x1, rect2.y1, rect2);
		spatialhash.set(rect3.x1, rect3.y1, rect3);
	
		console.log(spatialhash);
	
		// set up a player
		var player = new Mob({
			x: 3,
			y: 0,
			size: {
				x: 8,
				y: 8
			},
			vel: {
				x: 0,
				y: 1,
			}
		});
		player.draw = function(ctx) {
			var oldFillStyle = ctx.fillStyle;
			ctx.fillStyle = 'rgb(0, 0, 0)';
			ctx.fillRect(this.x, this.y, this.size.x, this.size.y);
			ctx.fillStyle = oldFillStyle;
		};
	
		$('#playerlog').click(function() {
			console.log(player);
		})
	
		tilemap.draw(ctx);
		player.draw(ctx);
	
		// set up the keyboardmanager
		var keyboardmanager = new KeyboardManager();
		keyboardmanager.eventer.subscribe('a', function() {
			player.vel.x = 1;
		})
	
		// set up the updater
		var updater = new Updater();
		// clear the canvas
		updater.add(function() {
			ctx.fillStyle = 'rgb(255, 255, 255)';
			ctx.fillRect(0, 0, 600, 500);
		});
		// move the player
		updater.add(function() {
			player.move(spatialhash.get(player.x, player.y));
		});
		// draw the stuff
		updater.add(function() {
			tilemap.draw(ctx);
			player.draw(ctx);
		});
		$(document).ready(function() {
			// start the updater
			updater.start();
		});
	</script>
</body>
</html>