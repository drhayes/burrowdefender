<!DOCTYPE HTML>
<html>
	<head>
		<title>Tiles</title>
		<script type="text/javascript" src="../lib/jquery/jquery-1.4.2.min.js"></script>
		<script type="text/javascript" src="qunit.js"></script>
		<script type="text/javascript" src="fakes.js"></script>
		<script type="text/javascript" src="../src/base.js"></script>
		<script type="text/javascript" src="../src/components.js"></script>
		<script type="text/javascript" src="../src/tileutils.js"></script>
		<script type="text/javascript" src="../src/world.js"></script>
		<script type="text/javascript" src="../src/tiles.js"></script>
		<link rel="stylesheet" href="qunit.css" type="text/css" media="screen" title="no title" charset="utf-8">
		<script>
			$(document).ready(function() {
				
				module('tiles', {
					setup: function() {
						this.fakegame = new FakeGame();
						this.fakectx =  new FakeCtx();
					}
				});
				
				test('dug', function() {
					loki.define('tiles', function(env) {
						equals(typeof env.dug, 'function', 'dug exists');
						var d = env.dug({game: this.fakegame});
						ok(!d.solid, 'dug is not solid');
						ok(!d.diggable, 'dug is not diggable');
					})
				});
				
				// test('Dirt', function() {
				// 	var me = this;
				// 	loki.define('tiles', function(env) {
				// 		checkexists(env.dirt, 'Dirt exists');
				// 		var dirt = env.dirt({game: me.fakegame});
				// 		ok(typeof(dirt.draw) == 'function', 'dirt draw exists');
				// 		ok(dirt.diggable, 'dirt is diggable');
				// 		dirt.draw(me.fakectx);
				// 		equals(me.fakectx.drawImageArgs.length, 1, 'drawImage called');
				// 		var args = me.fakectx.drawImageArgs[0];
				// 		equals(args.drx, 0, 'drawImage x');
				// 		equals(args.dry, 0, 'drawImage y');
				// 		equals(me.fakectx.fillRectArgs.length, 1, 'fill called');
				// 		args = me.fakectx.fillRectArgs[0];
				// 		equals(args.frx, 0, 'fillRect x');
				// 		equals(args.fry, 30, 'fillRect y');
				// 		equals(args.frw, tile.tilesize, 'fillRect width');
				// 		equals(args.frh, 3, 'fillRect height');
				// 	})
				// });
				
				// test('DirtWithGrass', function() {
				// 	checkexists(tile.dirtwithgrass, 'DirtWithGrass exists');
				// 	var dirt = tile.dirtwithgrass({game: this.fakegame});
				// 	ok(typeof(dirt.draw) === 'function', 'draw exists');
				// 	ok(dirt.diggable, 'DirtWithGrass is diggable');
				// 	dirt.draw(this.fakectx);
				// 	equals(this.fakectx.fillRectArgs.length, 1, 'fill called once');
				// });
				// 
				// test('drawdamage', function() {
				// 	equals(typeof(tile.drawdamage), 'function', 'drawdamage exists');
				// 	tile.drawdamage(this.fakectx, 1);
				// 	equals(this.fakectx.drawImageArgs.length, 0, 'drawImage not called');
				// 	tile.drawdamage(this.fakectx, 0.9);
				// 	equals(this.fakectx.drawImageArgs.length, 1, 'drawImage called');
				// 	var args = this.fakectx.drawImageArgs[0];
				// 	equals(args.drx, 0, 'x is 0');
				// 	equals(args.dry, 0, 'y is 0');
				// 	equals(args.img.src.substr(-11), 'cracks1.png', 'cracks1');
				// 	tile.drawdamage(this.fakectx, 0.6);
				// 	equals(this.fakectx.drawImageArgs.length, 2, 'drawImage called');
				// 	var args = this.fakectx.drawImageArgs[1];
				// 	equals(args.img.src.substr(-11), 'cracks2.png', 'cracks2');
				// 	tile.drawdamage(this.fakectx, 0.3);
				// 	equals(this.fakectx.drawImageArgs.length, 3, 'drawImage called');
				// 	var args = this.fakectx.drawImageArgs[2];
				// 	equals(args.img.src.substr(-11), 'cracks3.png', 'cracks3');
				// });
				// 
				// module('actual tile stuff', {
				// 	setup: function() {
				// 		this.fakegame = new FakeGame();
				// 		this.d = tile.dirt({
				// 			game: this.fakegame,
				// 			x: 32,
				// 			y: 32
				// 		});
				// 	}
				// })
				// 				
				// test('tick', function() {
				// 	expect(2);
				// 	var d = tile.dirt({game: this.fakegame});
				// 	d.healtick = function() {
				// 		ok(true, 'healtick');
				// 	};
				// 	d.mine = function() {
				// 		ok(true, 'mine');
				// 	};
				// 	d.tick();
				// });
				// 
				// test('dirt kill', function() {
				// 	var d = tile.dirt({
				// 		game: this.fakegame,
				// 		x: 0,
				// 		y: 0
				// 	});
				// });
				// 
				// test('damage', function() {
				// 	equals(typeof this.d.damage, 'function', 'damage exists');
				// });
			});
		</script>
	</head>
	<body>
		<h1 id="qunit-header">Tile Test</h1>
		<h2 id="qunit-banner"></h2>
		<h2 id="qunit-userAgent"></h2>
		<ol id="qunit-tests"></ol>
		<div id="qunit-fixture">test markup, will be hidden</div>
	</body>
</html>
